<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"> <!-- For proper character encoding -->
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- To render according to device width -->
    <link rel="icon" href="movie.png" type="image/x-icon">
    <title>Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <!-- searching movie -->
    <!-- <h1 id="main">Home</h1>
        <% if(username !== '') { %>
            <h2>Hello, <%= username %></h2>
        <% } %>

        <a style="color: blue;" href="<%= username === '' ? '/ratings' : '/userRatings?username=' + username %>">Reviews</a>
        <a style="color: blue;" href="<%= username === '' ? '/signup' : '/signup?username=' + username %>">Sign Up</a>
        <a style="color: blue;" href="<%= username === '' ? '/login' : '/login?username=' + username %>">Login</a>
        <% if(username !== '') { %>
            <a style="color: blue;" href="/">Logout</a>
        <% } %> -->

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <!-- Open's the collapsed NavBar -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="<%= username ? '/?username=' + username : '/' %>">CS108</a>
            </div>

            <!-- All of the further NavBar things should collapse when screen size is small-->

            <div class="collapse navbar-collapse" id="myNavbar">
                <!-- Left Navigation Bar -->
                <ul class="nav navbar-nav navbar-left">
                    <li class="active"><a href="<%= username ? '/?username=' + username : '/' %>">Home</a></li>
                    <li><a href="<%= username === '' ? '/ratings' : '/userRatings?username=' + username %>">Ratings</a>
                    </li>
                </ul>

                <!-- Search Bar -->

                <form class="navbar-form navbar-left"
                    action="<%= username !== '' ? '/submit?username=' + username : '/submit' %>" method="post">
                    <div class="input-group">
                        <input type="text" class="form-control" name="movieName" placeholder="Search Movies">
                        <div class="input-group-btn">
                            <button class="btn btn-default" type="submit">
                                <i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Right Navigation Bar -->
                <ul class="nav navbar-nav navbar-right">
                    <% if(username !=='' ) { %>
                        <p class="navbar-text">Hi, <%= username %>
                        </p>
                    <% } %>
                    <li><a href="<%= username === '' ? '/signup' : '/signup?username=' + username %>"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                    <li><a href="<%= username === '' ? '/login' : '/login?username=' + username %>"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                    <% if(username !=='' ) { %>
                        <li><a href="/"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                    <% } %>
                </ul>
            </div>
        </div>
    </nav>


    <!-- displaying movie info -->
    <%if(movies.length> 0 && movies[movies.length-1].Title != 'Movie Not Found'){ %>
        <% currentMovie=movies[movies.length -1] %>

            <!-- MOVIE INFO -->
            <% if(currentMovie.Image) { %>
                <div class="container" style="padding: 0;">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <div id="main-image-div">
                                    <div id="main-img-info">
                                        <div id="main-img-title"><%= currentMovie.Title %></div>
                                        <div id="durationRating"><strong><%= currentMovie.Year_Released%>, <%=  currentMovie.Duration  %>, <%= currentMovie.Age_Rating %></strong></div>
                                        <div id="genres"><%= currentMovie.Genres.join(", ") %></div>
                                        <a href="<%= currentMovie.Trailer_Links %>">
                                            <button id="trailer" type="button" class="btn btn-default">
                                                <span class="glyphicon glyphicon-play"></span> Trailer
                                            </button>
                                        </a>
                                    </div>
                                    <img id="main-image" src="<%= currentMovie.Image %>" alt="Image" class="img-fluid">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div id="side-img-div">
                                    <img id="side-img" src="<%= currentMovie.Image %>" alt="<%= currentMovie.Title %>" class="img-fluid">
                                </div>
                                <% if(userRating!=='' ) { %>
                                    <div class="container" id="main-userReviews">
                                        <h4><strong>Rating by our Users</strong></h4>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <p><%= userRating %></p>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                            <div class="col-md-6">
                                <div id="main-reviews" class="row">
                                    <% for(let i=0; i<currentMovie.Other_Ratings[0].length; i++) { %>
                                        <a href="<%= currentMovie.Other_Ratings[2][i] %>">
                                            <div class="col-md-4">
                                                <div class="media">
                                                    <div class="media-left">
                                                        <img width="50px" src="<%= '/rater_images/' + currentMovie.Other_Ratings[1][i].toLowerCase().replace(/ /g, '_') + '.png'%>" alt="<%= currentMovie.Other_Ratings[1][i] %>">
                                                    </div>
                                                    <div class="media-body">
                                                        <p><%= currentMovie.Other_Ratings[0][i] %></p>
                                                        <p><%= currentMovie.Other_Ratings[1][i] %></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    <% } %>
                                </div>
                                <div id="main-plot"  class="row">
                                    <div class="col-md-12">
                                        <p><%= currentMovie.Plots %></p>
                                    </div>
                                </div>
                                <div id="main-cast-directors" class="row">
                                    <div class="col-md-12">
                                        <h3><strong>Cast</strong></h3>
                                        <p><%= currentMovie.Casts.join(" | ") %></p>
                                        <h3><strong>Directors</strong></h3>
                                        <p><%= currentMovie.Directors.join(" | ") %></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div id="main-suggestions" class="container">
                                    <h3 style="text-align: center;" ><strong>You might like this</strong></h3>
                                    <% for(let i=0; i < suggestedMovies.length; i++) { %>
                                        <div class="row">
                                            <div class="col-md-12 sugg-items">
                                                <a style="color: black;" href="<%= username !== '' ? '/submit?movieName=' + suggestedMovies[i].Title + '&username=' + username : '/submit?movieName=' + suggestedMovies[i].Title%>">
                                                    <span class="glyphicon glyphicon-expand"></span> <%= suggestedMovies[i].Title %>
                                                </a>
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                                <% if(currentMovie.Streaming_Platforms[0].length) { %>
                                    <div id="main-streaming" class="container">
                                        <div class="row">
                                            <div class="col-md-12"><h3><strong>Where to watch?</strong></h3></div>
                                        </div>
                                        <% for(let i=0; i<currentMovie.Streaming_Platforms[0].length; i++) { %>
                                            <div class="row">
                                                <div class="col-md-1"></div>
                                                <div style="margin: 20px 0;" class="col-md-2 ">
                                                    <img src="<%='/sp_images/' + currentMovie.Streaming_Platforms[0][i].toLowerCase().replace(/ /g, '_') + '.png' %>" alt="">

                                                </div>
                                                <div style="margin: 25px 0;" class="col-md-6">
                                                    <a style="color: black;" href="<%= currentMovie.Streaming_Platforms[1][i] %>">
                                                        <strong><%= currentMovie.Streaming_Platforms[0][i] %></strong>
                                                    </a>
                                                </div>
                                                <div class="col-md-3"></div>
                                            </div>
                                        <% } %>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="media">
                        <div class="media-body">
                            <ul>
                                <li>Title: <%= currentMovie.Title %>
                                </li>
                                <li>Year Released: <%= currentMovie.Year_Released %>
                                </li>
                                <li>Duration: <%= currentMovie.Duration %>
                                </li>
                                <li>Rating: <%= currentMovie.Rating %>
                                </li>
                                <% if(userRating==='' ) { %>
                                    <li>No one rated till now!</li>
                                <% } else { %>
                                    <li>Rating by our users: <%= userRating %></li>
                                <% } %>
                                <li>Genre: <%= currentMovie.Genres.join(", ") %></li>
                                <li>Plot: <%= currentMovie.Plots %></li>
                                <li>Director: <%= currentMovie.Directors.join(" , "); %></li>
                                <li>Casts: <%= currentMovie.Casts.join(" , ") %></li>
                                <li><a style=" color: blue;" href="<%= currentMovie.Trailer_Links%>">Trailer</a></li>
                                <% if(currentMovie.Streaming_Platforms[0].length> 0) { %>
                                    <li>Streaming Platforms:
                                    <ul>
                                        <% for(let i=0; i<currentMovie.Streaming_Platforms[0].length; i++) { %>
                                              <li><a style="color: blue;" href="<%= currentMovie.Streaming_Platforms[1][i] %>"> <%= currentMovie.Streaming_Platforms[0][i] %></a></li>
                                        <% } %>
                                    </ul>
                                    </li>
                                <% } %>
                                <% if(currentMovie.Other_Ratings[0].length> 0) { %>
                                    <li>Other Ratings:
                                        <ul>
                                            <% for(let i=0; i<currentMovie.Other_Ratings[0].length; i++) { %>
                                                <li><a style="color: blue;" href="<%= currentMovie.Other_Ratings[2][i] %>"> <%= currentMovie.Other_Ratings[1][i] %></a>: <%= currentMovie.Other_Ratings[0][i] %></li>
                                            <% } %>
                                        </ul>
                                    </li>
                                <% } %>
                            </ul>
                        </div>
                        <div class="media-right">
                            <img class="img-rounded" width="300px" src="<%=currentMovie.Image%>" alt="">
                        </div> 
                    </div> -->
                </div>
            <% } %>

            <!-- ROTTEN TOMATOES REVIEWS -->
            <% if(outSideReviews.RottenTomatoes !=undefined && outSideReviews.RottenTomatoes.length> 0){ %>
                <div class="container" style="margin-top: 10px;">
                        <div class="panel panel-default">
                            <div style="padding: 40px;" class="panel-heading">
                                <h1 class="panel-title">
                                    <a style="font-size: 30px; font-weight: bold;" data-toggle="collapse" href="#RTReviews">
                                        <span class="glyphicon glyphicon-chevron-down"></span>
                                        <strong>Top Critic Reviews from Rotten Tomatoes</strong> 
                                    </a>
                                </h1>
                            </div>
                        </div>
                        <div class="panel-group collapse" id="RTReviews">
                            <% for(let i=0; i<outSideReviews.RottenTomatoes.length; i++) { %>
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <a style="color: blue" href="<%= outSideReviews.RottenTomatoes[i][1] %>"><%= outSideReviews.RottenTomatoes[i][0] %></a>
                                    </div>
                                    <div class="panel-body">
                                        <%= outSideReviews.RottenTomatoes[i][2] %>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                </div>
                <% } %>

    <!-- NORMAL SUGGESTIONS -->
    <% } else if (movies.length==0) { %>
        <div class="container">
            <% if(username !== '') { %>
                <h2>Hey <%= username %>, Check these out: </h2>
            <% } else { %>
                <h2>Check these out: </h2>
            <% } %>
            <% for(let j=0; j<Math.floor(suggestedMovies.length/4); j++) { %>
                <div class="row">
                    <% for(let i=0; i<4; i++)  { %>
                        <div class="col-md-3">
                            <div class="thumbnail">
                                <a href="<%= username !== '' ? '/submit?movieName=' + suggestedMovies[4*j+i].Title + '&username=' + username : '/submit?movieName=' + suggestedMovies[4*j+i].Title%>">
                                    <img width="300px" src="<%= suggestedMovies[4*j + i].Image %>" alt="<%= suggestedMovies[4*j + i].Title %>">
                                    <div class="caption">
                                        <p><%= suggestedMovies[4*j + i].Title %></p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    <% } %>
                </div>
            <% } %>
            <div class="row">
                <% for(let i=4*Math.floor(suggestedMovies.length/4); i<suggestedMovies.length; i++)  { %>
                    <div class="col-md-3">
                        <div class="thumbnail">
                            <a href="<%= username !== '' ? '/submit?movieName=' + suggestedMovies[i].Title + '&username=' + username : '/submit?movieName=' + suggestedMovies[i].Title%>">
                                <img width="300px" src="<%= suggestedMovies[i].Image %>" alt="<%= suggestedMovies[i].Title %>">
                                <div class="caption">
                                    <p><%= suggestedMovies[i].Title %></p>
                                </div>
                            </a>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>

    <!-- SEARCH SUGGESTIONS -->
    <% } else if (searchSuggestions.length> 0) { %>
        <div class="container">
            <h2>Did you mean these?</h2>
            <% for(let j=0; j<Math.floor(searchSuggestions.length/3); j++) { %>
                <div class="row">
                    <% for(let i=0; i<3; i++)  { %>
                        <div class="col-md-4">
                            <div class="thumbnail">
                                <a href="/submit?movieName=<%= searchSuggestions[3*j+i].Title %>&username=<%=username%>">
                                    <img width="300px" src="<%= searchSuggestions[3*j + i].Image %>" alt="<%= searchSuggestions[3*j + i].Title %>">
                                    <div class="caption">
                                        <p><%= searchSuggestions[3*j + i].Title %></p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    <% } %>
                </div>
            <% } %>
            <div class="row">
                <% for(let i=3*Math.floor(searchSuggestions.length/3); i<searchSuggestions.length; i++)  { %>
                    <div class="col-md-4">
                        <div class="thumbnail">
                            <a href="/submit?movieName=<%= searchSuggestions[i].Title %>&username=<%=username%>">
                                <img width="300px" src="<%= searchSuggestions[i].Image %>" alt="<%= searchSuggestions[i].Title %>">
                                <div class="caption">
                                    <p><%= searchSuggestions[i].Title %></p>
                                </div>
                            </a>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    <% } %>

</body>

</html>